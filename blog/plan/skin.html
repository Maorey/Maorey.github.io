<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一种基于前端工程化的整站综合换肤方案 | 玉书</title>
    <meta name="description" content="毛瑞的博客">
    <link rel="stylesheet" href="/assets/style.27f90eac.css">
    <link rel="modulepreload" href="/assets/Home.58daf432.js">
    <link rel="modulepreload" href="/assets/vssue.1b5f3e65.js">
    <link rel="modulepreload" href="/assets/viewer.6bf00c48.js">
    <link rel="modulepreload" href="/assets/echarts.b33419de.js">
    <link rel="modulepreload" href="/assets/flowchart.31c8d424.js">
    <link rel="modulepreload" href="/assets/mermaid.6e17d223.js">
    <link rel="modulepreload" href="/assets/runner.7dc2dd49.js">
    <link rel="modulepreload" href="/assets/app.9e23c0b3.js">
    <link rel="modulepreload" href="/assets/blog_plan_skin.md.0295313f.lean.js">
    <link rel="modulepreload" href="/assets/app.9e23c0b3.js">
    <link rel="icon" href="/logo.jpg">
    <meta name="twitter:title" content="一种基于前端工程化的整站综合换肤方案 | 玉书">
    <meta property="og:title" content="一种基于前端工程化的整站综合换肤方案 | 玉书">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="玉书, back to home" data-v-675d8756 data-v-4a583abe><img class="logo" src="/logo.jpg" alt="Logo" data-v-4a583abe> 玉书</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item active" href="/blog/" data-v-b8818f8c>博客 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/diary/" data-v-b8818f8c>日记 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/about.html" data-v-b8818f8c>关于我 <!----></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/Maorey/Blog" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item active" href="/blog/" data-v-b8818f8c>博客 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/diary/" data-v-b8818f8c>日记 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/about.html" data-v-b8818f8c>关于我 <!----></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/Maorey/Blog" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/js/">JavaScript笔记</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/js/iterator.html">迭代器</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/algorithm/">算法</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/algorithm/melkman.html">最小凸包</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/algorithm/pinp.html">点是否在多边形内</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/algorithm/dynamicProgramming.html">动态规划</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/plan/">想法&amp;方案</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/blog/plan/skin.html">一种基于前端工程化的整站综合换肤方案</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#背景">背景</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#换肤方案">换肤方案</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#构建时">构建时</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#运行时">运行时</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#目标">目标</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#实现思路">实现思路</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#具体实现">具体实现</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><p><s><em>2021-06-15</em></s> <em>2021-08-27</em></p><h2 id="背景"><a class="header-anchor" href="#背景" aria-hidden="true">#</a> 背景</h2><p>有时候需要网站能换肤, 嗯, 就酱</p><h2 id="换肤方案"><a class="header-anchor" href="#换肤方案" aria-hidden="true">#</a> 换肤方案</h2><p>换肤有两种应用场景, 一种是构建时生成单个指定皮肤, 常见于“换皮项目”; 一种是运行时切换皮肤, 满足用户个性化需求</p><p>这里仅作简单介绍, 欢迎讨论、补充</p><h3 id="构建时"><a class="header-anchor" href="#构建时" aria-hidden="true">#</a> 构建时</h3><p>即构建时生成指定皮肤, 主要面临的问题其实是项目管理方面的问题: 如何快速迭代满足甲方需求; 如何复用、同步各定制版本的功能; 如何避免版本/功能混乱、高耦合, 一个bug影响各个定制版本 等等</p><p>就换肤本身来说, 除了上述的问题外, 还存在因难以开发维护、难以自动化测试, 导致UI不稳定、风格不一致等问题</p><p>这里不展开讨论</p><h3 id="运行时"><a class="header-anchor" href="#运行时" aria-hidden="true">#</a> 运行时</h3><p>即网站本身提供了多个版本, 甚至允许自定义皮肤, 用户可以按照自己的喜好切换皮肤.</p><p>这其中又分需要刷新网页的和不需要刷新的, 前者常见于网站为不同特征用户提供不同的功能和交互体验的场景, 比如: 老年版普通版青少年版 普通版极简版 设计师商家用户 等等; 后者比较常见, 比如: 浅色深色模式 各种主题等</p><p>具体实现方案大概有以下几种 <a id="fnref"><!-- 表格里的描回不来┓( ´∀` )┏ --></a></p><table><thead><tr><th>方案</th><th>实现方式</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>配置文件</td><td>应用内根据配置项<ins title="可以与下面的方案结合">实现对应内容</ins></td><td>1. 样式和布局等都可配置<br>2. 允许用户自定义<br>3. 配置数据有移植潜力</td><td>1. 配置与应用强耦合, 配置项变更和管理成本较高</td></tr><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/var()" target="_blank" rel="noopener noreferrer">CSS变量</a><sup><a href="#fn1">[1]</a></sup></td><td>通过修改CSS变量值实现换肤</td><td>1. 实现简单快速<br>2. 样式变量代码集中</td><td>1. 难以修改布局、动画等, 无法修改<ins title="canvas">js控制的样式</ins><br>2. 不兼容IE</td></tr><tr><td>样式覆盖</td><td><ins title="一般在根元素上增加class, 对应的样式都在这个class选择器下">利用CSS样式优先级覆盖默认样式</ins></td><td>1. 实现简单快速<br>2. 样式代码集中</td><td>1. 修改布局不够优雅, <ins title="略有影响性能">代码冗余</ins>, 无法修改<ins title="canvas">js控制的样式</ins><br>2. 需要良好的规范及代码组织, 否则<ins title="比如滥用!important内联样式等">维护成本高</ins><br>3. 难以<ins title="需要设计规范、保存用户的css">允许用户自定义</ins></td></tr><tr><td><a href="https://developer.mozilla.org/docs/Web/CSS/Alternative_style_sheets" target="_blank" rel="noopener noreferrer">可替换样式表</a><sup><a href="#fn2">[2]</a></sup></td><td>通过可替换样式表来切换对应的样式文件</td><td>1. 样式<ins title="css可以完全不一样, 包括背景图、动画等等">自由度高</ins><br>2. 没有冗余代码, 整体<ins title="由浏览器来完整整个样式的切换">性能高</ins></td><td>1. 需要样式规范, 且无法修改<ins title="canvas">js控制的样式</ins><br>2. 难以<ins title="保存用户的css">允许用户自定义</ins><br>3. 增加打包时间和<ins title="但对浏览器的性能影响忽略不计, 因为可以先不加载或预加载, 切换的时候才会应用">体积</ins></td></tr><tr><td><a href="https://segmentfault.com/a/1190000000355277" target="_blank" rel="noopener noreferrer">Vanilla JS</a></td><td>Vanilla JS 😏</td><td>1. 自由度最高<br>2. 可配置且支持自定义<br>3. 支持canvas</td><td>1. 开发维护成本高<br>2. 性能开销高</td></tr></tbody></table><h2 id="目标"><a class="header-anchor" href="#目标" aria-hidden="true">#</a> 目标</h2><p>TODO: 来个表格</p><ol><li>整站换肤</li><li>易开发易维护降成本</li></ol><ul><li>默认自动注入皮肤变量同时生成多套可运行时切换的皮肤</li><li>支持异步chunk</li><li>css module / css object (<code>import STYLE from &#39;*.scss&#39;</code>) 支持</li><li>细粒度特殊处理支持: 允许指定注入的变量 &amp; 允许随皮肤切换样式和其他</li><li>易于开发调试</li></ul><ol start="3"><li>良好的扩展性 (用户定制)</li><li>无缝(刷新)切换/懒加载/预加载/按需加载皮肤</li></ol><h2 id="实现思路"><a class="header-anchor" href="#实现思路" aria-hidden="true">#</a> 实现思路</h2><p>TODO: 来个表格</p><ol><li>alternate stylesheet</li><li>scss/less... vars + webpack插件</li></ol><ul><li>loader 配置全局变量</li><li>runtime代码广播换肤事件(可自定义), 维护当前皮肤状态(全局变量, 可自定义)以待获取 (比如异步chunk)</li><li>搜集构建信息, 根据当前皮肤提供接口更新css object(如使用vue reactivity劫持下 可做到比如维护一套变量控制包括echarts在内的皮肤及切换)</li><li>提供接口, 构建时处理</li><li>支持热更新, 但暂不支持开发环境切换皮肤(style标签, 支持成本大, 要么丢热更新, 要么改style标签内容, 这都可以做成另一种换肤方案了), 支持使用指定皮肤(命令行参数)启动开发环境</li><li>暂不支持 css-in-js (styled-component 等)</li></ul><ol start="3"><li>可支持 css var、在线打包、上传css</li><li><code>&lt;link rel=&quot;preload/prefetch&quot;</code></li></ol><h2 id="具体实现"><a class="header-anchor" href="#具体实现" aria-hidden="true">#</a> 具体实现</h2><p>TODO: api/规范 + 工程化</p><!-- 没得办法, 只能人工脚注了┓( ´∀` )┏ --><hr> 1. 允许自定义css属性, 并在其作用域内的任何css中使用, 且修该自定义属性的值后, 使用该属性的样式会更新 <a href="#fnref" id="fn1">↩︎</a><div class="language-css line-numbers-mode"><pre><code><span class="token comment">/* :root: 全局变量 */</span>
<span class="token selector">:root</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 自定义属性必须以 -- 开头 */</span>
  <span class="token property">--main-bg-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 变量无效(未定义/作用域...)时显示red */</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--main-bg-color<span class="token punctuation">,</span> red<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>它是 <a href="https://www.w3.org/TR/html401/present/styles.html#h-14.3" target="_blank" rel="noopener noreferrer">HTML 4.01 规范</a> 中的内容, 允许切换网页使用的样式表, 切换样式方式如下 <a href="#fnref" id="fn2">↩︎</a></li></ol><div class="language-html line-numbers-mode"><pre><code>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/Maorey/Blog/edit/master/docs/blog/plan/skin.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>编辑本文 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>上次更新:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/blog/plan/" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>想法&amp;方案</span></a></div><div class="next" data-v-38ede35f><!----></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"404.md\":\"ed3b3968\",\"about.md\":\"ae4b5365\",\"index.md\":\"7a38e126\",\"blog_index.md\":\"649e8518\",\"diary_20210327.md\":\"cc435c18\",\"diary_20210504.md\":\"b8814458\",\"diary_checklist.md\":\"9ec560ec\",\"diary_index.md\":\"9afc47db\",\"blog_algorithm_dynamicprogramming.md\":\"d64c2708\",\"blog_algorithm_index.md\":\"4019b174\",\"blog_algorithm_melkman.md\":\"119e0ff3\",\"blog_algorithm_pinp.md\":\"283f57ef\",\"blog_js_index.md\":\"8f5f719a\",\"blog_js_iterator.md\":\"5fb1259b\",\"blog_plan_index.md\":\"4d0b80bb\",\"blog_plan_skin.md\":\"0295313f\"}")</script>
    <script type="module" async src="/assets/app.9e23c0b3.js"></script>
  </body>
</html>